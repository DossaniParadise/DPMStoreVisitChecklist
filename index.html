
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dossani Paradise ‚Äì AC Store Inspection</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg: #0b1220;
      --card: #111827;
      --muted: #9aa4b2;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --accent-2:#34d399;
      --warn:#f59e0b;
      --danger:#ef4444;
      --border:#1f2937;
      --chip:#374151;
      --chip-on:#10b981;
      --chip-pend:#f59e0b;
      --chip-off:#6b7280;
      --pill:#0ea5e9;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(135deg,#0b1220 0%,#0f172a 100%);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    a{color:var(--accent)}
    header{
      position:sticky;top:0;z-index:50;
      background:rgba(11,18,32,.75);backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border)
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .brand{
      display:flex;align-items:center;gap:12px;font-weight:700;font-size:18px;letter-spacing:.2px
    }
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-left:auto}
    .toolbar button,.toolbar label{
      background:#0f172a;border:1px solid var(--border);color:var(--text);
      padding:8px 12px;border-radius:8px;cursor:pointer;box-shadow:var(--shadow);
      display:inline-flex;align-items:center;gap:8px
    }
    .toolbar input[type="file"]{display:none}
    main .wrap{display:grid;grid-template-columns:280px 1fr;gap:18px}
    .panel{
      background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:var(--shadow)
    }
    .h{margin:0 0 8px 0;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .inputs{display:grid;gap:10px;margin-top:10px}
    .inputs input{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);
      background:#0f172a;color:var(--text)
    }
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tab{
      padding:8px 12px;border-radius:999px;border:1px solid var(--border);cursor:pointer;
      background:#0f172a;color:var(--text);font-weight:600
    }
    .tab[aria-selected="true"]{background:var(--pill);border-color:transparent}
    .progress{
      display:flex;align-items:center;gap:12px;margin-top:12px
    }
    .bar{flex:1;height:10px;background:#0f172a;border-radius:99px;overflow:hidden;border:1px solid var(--border)}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%}
    .pct{min-width:48px;text-align:right;font-variant-numeric:tabular-nums}
    .grid{display:grid;gap:16px}
    .cat{border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .cat > h3{margin:0;padding:12px 14px;background:#0f172a;border-bottom:1px solid var(--border);font-size:16px}
    .task{display:grid;grid-template-columns: 1.2fr 200px 1fr 1fr 160px;gap:10px;align-items:start;padding:12px 14px;border-top:1px dashed #1f2937}
    .task:first-of-type{border-top:none}
    .task-title{font-weight:600}
    .choices{display:flex;gap:6px;flex-wrap:wrap}
    .chip{
      padding:6px 10px;border-radius:999px;background:var(--chip);cursor:pointer;border:1px solid var(--border);
      user-select:none;font-size:12px;display:inline-flex;align-items:center;gap:6px
    }
    .chip[data-val="Yes"][aria-pressed="true"]{background:var(--chip-on)}
    .chip[data-val="Pending"][aria-pressed="true"]{background:var(--chip-pend)}
    .chip[data-val="No"][aria-pressed="true"]{background:var(--danger)}
    .task textarea,.task input[type="date"]{
      width:100%;background:#0f172a;border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px;min-height:38px
    }
    .section-head{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:12px 0}
    .muted{color:var(--muted)}
    .footer{margin:24px 0 60px;color:var(--muted);font-size:12px}
    @media (max-width: 980px){
      main .wrap{grid-template-columns:1fr}
      .task{grid-template-columns:1fr;gap:8px}
      .pct{min-width:auto}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;align-items:center;gap:16px;">
    <div class="brand"><span class="dot"></span> Dossani Paradise ‚Äî AC Store Inspection</div>
    <div class="toolbar">
      <button id="btnExport" title="Export current state to a JSON file">üíæ Export</button>
      <label for="fileImport" title="Import previously exported JSON">üìÇ Import
        <input id="fileImport" type="file" accept="application/json" />
      </label>
      <button id="btnPrint" title="Print or Save to PDF">üñ®Ô∏è Save as PDF</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <!-- Left: Meta & Tabs -->
    <aside class="panel">
      <h2 class="h">AC Store Inspection</h2>
      <div class="sub">Fill out the inspection details and complete tasks for each tab.</div>
      <div class="inputs">
        <input id="inpDate" type="date" />
        <input id="inpStore" type="text" placeholder="Store Location" />
        <input id="inpInspector" type="text" placeholder="Inspector Name" />
      </div>

      <div class="section-head">
        <div class="sub">Sheets</div>
      </div>
      <div class="tabs" id="tabs"></div>

      <div class="section-head">
        <div class="sub">Inspection Progress</div>
        <div class="pct" id="pct">0%</div>
      </div>
      <div class="progress">
        <div class="bar"><span id="bar"></span></div>
      </div>
    </aside>

    <!-- Right: Checklist -->
    <section class="panel">
      <div class="section-head">
        <div>
          <h3 id="sheetTitle" style="margin:0;font-size:18px">Loading‚Ä¶</h3>
          <div class="muted" id="sheetSubtitle">Select a sheet to begin.</div>
        </div>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div class="footer">Tip: use <strong>Export</strong> to save progress locally and <strong>Import</strong> to resume later.</div>
    </section>
  </div>
</main>

<script>
/**
 * ===========================================
 * Data model (from your spreadsheet)
 * ===========================================
 * Each sheet has categories with tasks. For every task we keep:
 *  - status: "Yes" | "No" | "Pending" | null
 *  - comment: string
 *  - action: string
 *  - followUp: yyyy-mm-dd | ""
 */
const SHEETS = [
  {
    key: "CS",
    title: "DPM CS Store Visit Checklist",
    categories: {
      "People & Scheduling": [
        "GM Schedule Reviewed",
        "Employee Schedules Reviewed",
        "Employee Turnover Ratios Reviewed",
      ],
      "Operations & Standards": [
        "Exterior Cleanliness",
        "Interior Cleanliness",
        "Fuel Area Cleanliness",
        "Pump Maintenance and Cleanliness",
        "Uniform Policy Compliance",
        "Store Shift Walk Completed",
        "Restrooms Clean & Logs Complete",
      ],
      "Customer Experience": [
        "Customer Service Observation (‚ÄúWelcome to Paradise‚Äù)",
        "Upselling Observed",
      ],
      "Cash & Controls": [
        "Petty Cash Count Matches",
        "Safe Drops Observed and Matching Totals",
        "Cash Over / Short Reviewed",
        "Refunds / Deletes / Voids / Manager Meals Reviewed",
        "All Cash Paid-Outs Match Invoices & Daily Paperwork",
      ],
      "Financial Performance": [
        "Inside Sales vs Plan Reviewed",
        "Fuel Gallons Sales vs Plan Reviewed",
      ],
      "Fuel & Compliance": [
        "ATG Fuel Reading Printed & Entered in CSPro",
        "Leak Test Printed & Uploaded in Bitrix",
        "Daily Fuel Prices Email Sent",
      ],
      "Accounts & Audit": [
        "Charge Customer Deposits Verified",
        "Audit Charge Customer Sales & Collections (CSPro)",
      ],
    },
  },
  {
    key: "FF",
    title: "DPM FF Store Visit Checklist",
    categories: {
      "People & Scheduling": [
        "GM Schedule Reviewed",
        "Employee Schedules Reviewed",
        "Employee Turnover Ratios Reviewed",
      ],
      "Cleanliness & Operations Standards": [
        "Exterior Cleanliness",
        "Interior Cleanliness",
        "Preventatie Maintenance Checklists Completed",
        "POP & Menu Boards Accurate and Current",
        "Uniform Policy Compliance",
        "Store Organization (BOH & FOH)",
      ],
      "Guest Experience": [
        "Customer Service Observation (YOU RULE! / Crowns Offered)",
        "OSAT ‚Äì Top 3 Opportunities Reviewed",
      ],
      "Cash & Controls": [
        "Petty Cash Count Matches",
        "Safe Drops Observed and Matching Totals",
        "Cash Over / Short Reviewed",
        "Refunds / Deletes / Voids / Manager Meals Reviewed",
        "All Cash Paid-Outs Match Invoices & Daily Paperwork",
      ],
      "Financial Performance": [
        "Sales vs. Plan",
        "Labor vs. Plan",
        "Weekly COGS vs. Ideal",
      ],
      "Food Safety & Compliance": [
        "Food Safety Criticals Reviewed",
        "SOS Compliance (No Parking Cars)",
        "BK Log Completion",
        "CHEF Audit Grades Reviewed",
      ],
      "Systems & Execution": [
        "King Board Updated",
        "Command Center Accuracy",
        "All Equipment in Working Condition",
      ],
      "Facilities & Controls": [
        "Restrooms Clean & Logs Complete",
        "Playground Clean & Logs Complete",
        "Petty Cash Count Matches",
      ],
      "Leadership Follow-Up": [
        "ACR Complaints Reviewed with GM",
      ],
    },
  },
  {
    key: "FFOld",
    title: "Store Visit Checklist",
    categories: {
      "People & Scheduling": [
        "GM Schedule Reviewed",
        "Employee Schedules Reviewed",
        "Employee Turnover Ratios Reviewed",
      ],
      "Cleanliness & Brand Standards": [
        "Overall Restaurant Cleanliness",
        "Cleanliness vs. Cleaning Charts",
        "POP & Menu Boards Accurate and Current",
        "Uniform Policy Compliance",
        "Store Organization (BOH & FOH)",
      ],
      "Guest Experience": [
        "Customer Service Observation (YOU RULE! / Crowns Offered)",
        "OSAT ‚Äì Top 3 Opportunities Reviewed",
      ],
      "Financial Performance": [
        "Sales vs. Plan",
        "Labor vs. Plan",
        "Weekly COGS vs. Ideal",
      ],
      "Food Safety & Compliance": [
        "Food Safety Criticals Reviewed",
        "SOS Compliance (No Parking Cars)",
        "BK Log Completion",
        "CHEF Audit Grades Reviewed",
      ],
      "Systems & Execution": [
        "King Board Updated",
        "Command Center Accuracy",
        "All Equipment in Working Condition",
      ],
      "Facilities & Controls": [
        "Restrooms Clean & Logs Complete",
        "Playground Clean & Logs Complete",
        "Petty Cash Count Matches",
      ],
      "Leadership Follow-Up": [
        "ACR Complaints Reviewed with GM",
      ],
    },
  },
];

// Build a default state object from SHEETS
function buildEmptyState(){
  const state = { meta: { date:"", store:"", inspector:"" }, sheet: SHEETS[0].key, answers:{} };
  for(const s of SHEETS){
    state.answers[s.key] = {};
    for(const [cat,tasks] of Object.entries(s.categories)){
      state.answers[s.key][cat] = tasks.map(t => ({
        title: t, status: null, comment:"", action:"", followUp:""
      }));
    }
  }
  return state;
}

let STATE = buildEmptyState();

/* =========== Persistence (Export/Import) =========== */
function download(filename, text){
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type:'application/json'}));
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}
document.getElementById('btnExport').addEventListener('click', ()=>{
  // Capture meta before export
  captureMeta();
  download(`ac_inspection_${new Date().toISOString().slice(0,10)}.json`, JSON.stringify(STATE, null, 2));
});
document.getElementById('fileImport').addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    try{
      const obj = JSON.parse(String(ev.target.result));
      // naive validation
      if(!obj || !obj.answers) throw new Error("Invalid file");
      STATE = obj;
      renderAll();
    }catch(err){
      alert("Import failed: " + err.message);
    }
  };
  reader.readAsText(f);
});
document.getElementById('btnPrint').addEventListener('click', ()=> window.print());

/* =========== UI Rendering =========== */
const tabsEl = document.getElementById('tabs');
const gridEl = document.getElementById('grid');
const barEl = document.getElementById('bar');
const pctEl = document.getElementById('pct');
const sheetTitle = document.getElementById('sheetTitle');
const sheetSubtitle = document.getElementById('sheetSubtitle');

function renderTabs(){
  tabsEl.innerHTML = '';
  for(const s of SHEETS){
    const btn = document.createElement('button');
    btn.className = 'tab';
    btn.type = 'button';
    btn.textContent = s.key;
    btn.setAttribute('aria-selected', STATE.sheet === s.key ? 'true':'false');
    btn.addEventListener('click', ()=>{
      STATE.sheet = s.key;
      renderAll();
      window.scrollTo({top:0,behavior:'smooth'});
    });
    tabsEl.appendChild(btn);
  }
}

function choiceChip(val, current, onPick){
  const b = document.createElement('button');
  b.type = 'button';
  b.className = 'chip';
  b.dataset.val = val;
  b.setAttribute('aria-pressed', current === val ? 'true':'false');
  b.innerHTML = (val === 'Yes' ? '‚úÖ' : val === 'No' ? '‚ùå' : '‚è≥') + ' ' + val;
  b.addEventListener('click', ()=> onPick(val));
  return b;
}

function renderGrid(){
  const s = SHEETS.find(x => x.key === STATE.sheet);
  sheetTitle.textContent = s.title;
  sheetSubtitle.textContent = `Sheet: ${s.key}`;
  gridEl.innerHTML = '';

  const data = STATE.answers[s.key];
  let done = 0, total = 0;

  for(const [cat, tasks] of Object.entries(data)){
    const wrap = document.createElement('div');
    wrap.className = 'cat';

    const h3 = document.createElement('h3');
    h3.textContent = cat;
    wrap.appendChild(h3);

    tasks.forEach((t, idx)=>{
      total++;
      if(t.status === 'Yes') done++;

      const row = document.createElement('div');
      row.className = 'task';

      const title = document.createElement('div');
      title.className = 'task-title';
      title.textContent = t.title;

      const choices = document.createElement('div');
      choices.className = 'choices';
      ['Yes','Pending','No'].forEach(opt=>{
        choices.appendChild(choiceChip(opt, t.status, (val)=>{
